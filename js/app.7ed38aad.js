(function(){"use strict";var e={914:function(e,t,s){var a=s(9242),o=s(3396),n=s(7139);const r={class:"container"},i={class:"header"},l=(0,o._)("div",{class:"hosting"},[(0,o.Uk)("Backend hosted by "),(0,o._)("a",{href:"https://somee.com/default.aspx"},"somee.com"),(0,o.Uk)("!")],-1),c={class:"header-links"},d={class:"main"},u=(0,o._)("footer",null,[(0,o._)("p",null,[(0,o.Uk)("Created by "),(0,o._)("a",{href:"https://github.com/skorikovkr"},"skorikovkr"),(0,o.Uk)(".")]),(0,o._)("p",null,[(0,o.Uk)("Backend and database hosted by "),(0,o._)("a",{href:"https://somee.com/default.aspx"},"somee.com"),(0,o.Uk)(".")]),(0,o._)("p",null,"Frontend hosted by GitHub Pages.")],-1);function m(e,t,s,a,m,h){const p=(0,o.up)("router-link"),g=(0,o.up)("router-view");return(0,o.wg)(),(0,o.iD)("div",r,[(0,o._)("header",i,[l,(0,o._)("ul",c,[(0,o._)("li",null,[(0,o.Wm)(p,{to:"/",class:"header-link"},{default:(0,o.w5)((()=>[(0,o.Uk)("WebChat")])),_:1})]),(0,o._)("li",null,[(0,o.Wm)(p,{to:"/chats",class:(0,n.C_)(["header-link",{invisible:m.authorized}])},{default:(0,o.w5)((()=>[(0,o.Uk)("Chats")])),_:1},8,["class"])]),(0,o._)("li",null,[(0,o.Wm)(p,{to:"/friends",class:(0,n.C_)(["header-link",{invisible:m.authorized}])},{default:(0,o.w5)((()=>[(0,o.Uk)("Friends")])),_:1},8,["class"])]),(0,o._)("li",null,[(0,o.Wm)(p,{to:"/signin",class:(0,n.C_)(["header-link",{invisible:!m.authorized}])},{default:(0,o.w5)((()=>[(0,o.Uk)("Sign In")])),_:1},8,["class"])]),(0,o._)("li",null,[(0,o.Wm)(p,{to:"/registration",class:(0,n.C_)(["header-link",{invisible:!m.authorized}])},{default:(0,o.w5)((()=>[(0,o.Uk)(" Registration ")])),_:1},8,["class"])]),(0,o._)("li",null,[(0,o._)("a",{href:"#",onClick:t[0]||(t[0]=(...e)=>h.onSignOut&&h.onSignOut(...e)),class:(0,n.C_)(["header-link",{invisible:m.authorized}])},[(0,o.Uk)("Sign out "),(0,o._)("b",null,(0,n.zw)(m.username),1)],2)])])]),(0,o._)("main",d,[(0,o.Wm)(g,{onUpdatedLocalstorage:h.onLocalStorageChange},null,8,["onUpdatedLocalstorage"])]),u])}s(7658);let h;h="https://www.skorikovkr.somee.com";const p={API_URL:h,ACCESS_TOKEN_KEY:"access-token-key"};var g=p;s(2801);class f{signIn(e,t){return fetch(g.API_URL+"/Identity/SignIn",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}).then((async e=>{const t=await e.text();var s=t.split(".")[1],a=s.replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(window.atob(a).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));const n=JSON.parse(o)["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"];return localStorage.setItem(g.ACCESS_TOKEN_KEY,t),localStorage.setItem("username",n),{data:t,success:200===e.status}}))}register(e,t){return fetch(g.API_URL+"/Identity/Register",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}).then((async e=>({success:200===e.status})))}signOut(){const e=localStorage.getItem(g.ACCESS_TOKEN_KEY);return fetch(g.API_URL+"/Identity/Logout",{method:"POST",credentials:"include",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",Authorization:"Bearer "+e}}).then((async e=>{const t=await e.text();return localStorage.removeItem(g.ACCESS_TOKEN_KEY),localStorage.removeItem("username"),{data:t,success:200===e.status}}))}}const _=s(9822),w=(new _.HubConnectionBuilder).withUrl(g.API_URL+"/chat",{accessTokenFactory:()=>localStorage.getItem(g.ACCESS_TOKEN_KEY)}).withAutomaticReconnect({nextRetryDelayInMilliseconds:e=>e.elapsedMilliseconds<6e4?1e4*Math.random():null}).build();localStorage.getItem(g.ACCESS_TOKEN_KEY)&&w.start().then((()=>{console.log(w.connectionId)})).catch((e=>{console.log("")}));var v={data(){return{authorized:!localStorage.getItem(g.ACCESS_TOKEN_KEY),username:localStorage.getItem("username")}},methods:{onLocalStorageChange(){this.authorized=!localStorage.getItem(g.ACCESS_TOKEN_KEY),this.username=localStorage.getItem("username")},onSignOut(){new f;localStorage.removeItem(g.ACCESS_TOKEN_KEY),this.username=null,this.onLocalStorageChange(),this.$router.push("/")}}},S=s(89);const C=(0,S.Z)(v,[["render",m]]);var b=C,y=s(2483);const k={class:"main-container"},I=(0,o.uE)('<h1 data-v-32a75e1c>Welcome to WebChat.</h1><p data-v-32a75e1c>Used solution stack:</p><ul class="stack" data-v-32a75e1c><li data-v-32a75e1c>ASP .NET Core Web API</li><li class="description" data-v-32a75e1c> Backend that exposes API for getting chat history, adding friends and making chat rooms. Also provides authentication and authorization with Identity framework. </li><li data-v-32a75e1c>Entity Framework</li><li class="description" data-v-32a75e1c>ORM for my relational database.</li><li data-v-32a75e1c>SQL Server</li><li class="description" data-v-32a75e1c> Relational database for storing friends relationships, chat histories and info about chat rooms. </li><li data-v-32a75e1c>Vue</li><li class="description" data-v-32a75e1c> Frontend framework for SPA that provides routing and component system. </li><li data-v-32a75e1c>SignalR</li><li class="description" data-v-32a75e1c> Backend lib and browser client for realtime message sending between clients. </li></ul>',3),R=[I];function E(e,t,s,a,n,r){return(0,o.wg)(),(0,o.iD)("div",k,R)}var A={name:"Home"};const O=(0,S.Z)(A,[["render",E],["__scopeId","data-v-32a75e1c"]]);var T=O;function U(e,t,s,a,o,n){return" About "}var P={name:"About",mounted(){}};const K=(0,S.Z)(P,[["render",U]]);var M=K;const N=e=>((0,o.dD)("data-v-53efd67f"),e=e(),(0,o.Cn)(),e),j={class:"auth-form"},x=N((()=>(0,o._)("label",{for:"username"},"Username:",-1))),H=N((()=>(0,o._)("label",{for:"password"},"Password:",-1)));function L(e,t,s,r,i,l){return(0,o.wg)(),(0,o.iD)("form",j,[(0,o._)("p",{class:(0,n.C_)({error:null!=i.error})},(0,n.zw)(i.error),3),x,(0,o.wy)((0,o._)("input",{id:"username","onUpdate:modelValue":t[0]||(t[0]=e=>i.username=e),required:"",placeholder:"Username"},null,512),[[a.nr,i.username]]),H,(0,o.wy)((0,o._)("input",{id:"password",type:"password","onUpdate:modelValue":t[1]||(t[1]=e=>i.password=e),required:"",placeholder:"Password"},null,512),[[a.nr,i.password]]),(0,o._)("button",{type:"submit",onClick:t[2]||(t[2]=(0,a.iM)(((...e)=>l.onsubmit&&l.onsubmit(...e)),["prevent"]))},"SignIn")])}var z={name:"SignIn",data(){return{username:"",password:"",error:null}},methods:{onsubmit(){const e=new f;""!==this.username&&""!==this.password?e.signIn(this.username,this.password).then((e=>{e.success?(this.error=null,this.$emit("updated-localstorage"),this.$router.push("chats")):this.error=e.data})):this.error="Both username and password should be filled."}},mounted(){localStorage.getItem(g.ACCESS_TOKEN_KEY)&&this.$router.push("chats")}};const Y=(0,S.Z)(z,[["render",L],["__scopeId","data-v-53efd67f"]]);var D=Y;const W=e=>((0,o.dD)("data-v-2fb5cea5"),e=e(),(0,o.Cn)(),e),B={class:"auth-form"},Z=W((()=>(0,o._)("label",{for:"username"},"Username:",-1))),F=W((()=>(0,o._)("label",{for:"password"},"Password:",-1))),$=W((()=>(0,o._)("label",{for:"password"},"Confirm password:",-1)));function V(e,t,s,r,i,l){return(0,o.wg)(),(0,o.iD)("form",B,[(0,o._)("p",{class:(0,n.C_)({error:null!=i.error})},(0,n.zw)(i.error),3),Z,(0,o.wy)((0,o._)("input",{id:"username","onUpdate:modelValue":t[0]||(t[0]=e=>i.username=e),required:"",placeholder:"Username"},null,512),[[a.nr,i.username]]),F,(0,o.wy)((0,o._)("input",{id:"password",type:"password","onUpdate:modelValue":t[1]||(t[1]=e=>i.password=e),required:"",placeholder:"Password"},null,512),[[a.nr,i.password]]),$,(0,o.wy)((0,o._)("input",{id:"passwordConfirm",type:"password","onUpdate:modelValue":t[2]||(t[2]=e=>i.confirmPassword=e),required:"",placeholder:"Confirm password"},null,512),[[a.nr,i.confirmPassword]]),(0,o._)("button",{type:"submit",onClick:t[3]||(t[3]=(0,a.iM)(((...e)=>l.onsubmit&&l.onsubmit(...e)),["prevent"]))},"SignIn")])}var q={name:"Registration",data(){return{username:"",password:"",confirmPassword:"",error:null}},methods:{onsubmit(){const e=new f;""!==this.username&&""!==this.password&&""!==this.confirmPassword?this.password===this.confirmPassword?e.register(this.username,this.password).then((t=>{t.success?(this.error=null,e.signIn(this.username,this.password).then((e=>{e.success?(this.$emit("updated-localstorage"),this.$router.push("chats")):this.error="Error with signing you in. Please try to Sign in again."}))):this.error=t.data})):this.error="Password mismatch. Please try again.":this.error="Both username and password should be filled."}},mounted(){localStorage.getItem(g.ACCESS_TOKEN_KEY)&&this.$router.push("chats")}};const G=(0,S.Z)(q,[["render",V],["__scopeId","data-v-2fb5cea5"]]);var J=G;function Q(e,t,s,a,o,n){return null}var X={name:"Friends"};const ee=(0,S.Z)(X,[["render",Q]]);var te=ee;const se={class:"chat-container"};function ae(e,t,s,a,n,r){const i=(0,o.up)("chat-rooms-list"),l=(0,o.up)("message-area");return(0,o.wg)(),(0,o.iD)("div",se,[(0,o.Wm)(i,{onRoomSelected:r.onRoomSelected},null,8,["onRoomSelected"]),(0,o.Wm)(l,{messageHistory:n.messageHistory,selectedRoom:n.selectedRoom},null,8,["messageHistory","selectedRoom"])])}const oe=e=>((0,o.dD)("data-v-b2515bfe"),e=e(),(0,o.Cn)(),e),ne={class:"rooms-list"},re=oe((()=>(0,o._)("span",null,"Your chats:",-1)));function ie(e,t,s,a,n,r){const i=(0,o.up)("chat-room-list-item");return(0,o.wg)(),(0,o.iD)("div",ne,[re,(0,o._)("ul",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.rooms,(e=>((0,o.wg)(),(0,o.j4)(i,{chat:e,onRoomClicked:r.onRoomClick},null,8,["chat","onRoomClicked"])))),256))])])}function le(e,t,s,a,r,i){return(0,o.wg)(),(0,o.iD)("li",{class:"chat",onClick:t[0]||(t[0]=(...e)=>i.roomOnClick&&i.roomOnClick(...e))},(0,n.zw)(s.chat.displayName),1)}var ce={name:"ChatRoomListItem",props:["chat"],methods:{roomOnClick(){this.$emit("room-clicked",this.chat.name)}}};const de=(0,S.Z)(ce,[["render",le],["__scopeId","data-v-7f4736b3"]]);var ue=de;class me{getChatRooms(){const e=localStorage.getItem(g.ACCESS_TOKEN_KEY);return fetch(g.API_URL+"/Chat/GetAvailableRooms",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e}}).then((async e=>{const t=await e.json();return{data:t,success:200===e.status}}))}getChatHistory(e){const t=localStorage.getItem(g.ACCESS_TOKEN_KEY);return fetch(g.API_URL+"/Chat/GetRoomMessageHistory?roomName="+e,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t}}).then((async e=>{const t=await e.json();return{data:t,success:200===e.status}}))}}var he={name:"ChatRoomsList",components:{ChatRoomListItem:ue},data(){return{rooms:[],selectedRoom:null}},methods:{async onRoomClick(e){const t=new me;await w.invoke("ConnectToRoom",e),t.getChatHistory(e).then((t=>{t.success?(this.selectedRoom=e,this.$emit("room-selected",t.data,this.selectedRoom)):this.error=t.data}))}},mounted(){const e=new me;e.getChatRooms().then((e=>{e.success?this.rooms=e.data:this.error=e.data}))}};const pe=(0,S.Z)(he,[["render",ie],["__scopeId","data-v-b2515bfe"]]);var ge=pe;const fe={class:"message-container"},_e={class:"message-area",id:"messageArea"},we={id:"messageSendingForm"};function ve(e,t,s,r,i,l){const c=(0,o.up)("message");return(0,o.wg)(),(0,o.iD)("div",fe,[(0,o._)("div",_e,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(s.messageHistory,(e=>((0,o.wg)(),(0,o.j4)(c,{text:e.text,username:e.userName},null,8,["text","username"])))),256))]),(0,o._)("form",we,[(0,o.wy)((0,o._)("input",{id:"messageInput","onUpdate:modelValue":t[0]||(t[0]=e=>i.messageToSend=e),autocomplete:"off",class:(0,n.C_)({invisible:!s.selectedRoom})},null,2),[[a.nr,i.messageToSend]]),(0,o._)("button",{onClick:t[1]||(t[1]=(0,a.iM)(((...e)=>l.sendMessage&&l.sendMessage(...e)),["prevent"])),id:"sendMessageButton",class:(0,n.C_)({invisible:!s.selectedRoom})},"Send",2)])])}const Se={class:"username"},Ce={class:"text"};function be(e,t,s,a,r,i){return(0,o.wg)(),(0,o.iD)("div",{class:(0,n.C_)(["message",{"to-right":s.username===r.currentUsername}])},[(0,o._)("span",Se,(0,n.zw)(s.username),1),(0,o._)("span",Ce,(0,n.zw)(s.text),1)],2)}var ye={name:"Message",props:["text","username"],data(){return{currentUsername:localStorage.getItem("username")}}};const ke=(0,S.Z)(ye,[["render",be],["__scopeId","data-v-0295e3ad"]]);var Ie=ke,Re={name:"MessageArea",components:{Message:Ie},props:{messageHistory:Array,selectedRoom:String},data(){return{messageToSend:""}},methods:{async sendMessage(){await w.invoke("SendMessageToRoom",this.selectedRoom,this.messageToSend.replace("/(?:\\r\\n|\\r|\\n)/g","")),this.messageToSend=""},addMessageToHistory(e){this.messageHistory.push(e)}},async mounted(){messageArea.scrollTop=messageArea.scrollHeight;const e=this.addMessageToHistory;w.on("RecieveMessage",(function(t,s){let a=s.replace(/&/g,"&amp;").replace(/</g,"&lt").replace(/>/g,"&gt");const o={userName:t,text:a};e(o),setTimeout((()=>{messageArea.scrollTop=messageArea.scrollHeight}),500)})),w.on("Notify",(function(e){console.log(e)}))}};const Ee=(0,S.Z)(Re,[["render",ve],["__scopeId","data-v-1f28a1d1"]]);var Ae=Ee,Oe={name:"Chats",components:{MessageArea:Ae,ChatRoomsList:ge},data(){return{messageHistory:[],selectedRoom:null}},methods:{async onRoomSelected(e,t){this.messageHistory=e,this.selectedRoom=t}}};const Te=(0,S.Z)(Oe,[["render",ae],["__scopeId","data-v-39f40d38"]]);var Ue=Te;const Pe=[{path:"/",name:"Home",component:T},{path:"/about",name:"About",component:M},{path:"/signin",name:"Sign In",component:D},{path:"/registration",name:"Registration",component:J},{path:"/friends",name:"Friends",component:te},{path:"/chats",name:"Chats",component:Ue}],Ke=(0,y.p7)({history:(0,y.PO)("/webchat-vue-frontend/"),routes:Pe});var Me=Ke;(0,a.ri)(b).use(Me).mount("#app")}},t={};function s(a){var o=t[a];if(void 0!==o)return o.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,s),n.exports}s.m=e,function(){var e=[];s.O=function(t,a,o,n){if(!a){var r=1/0;for(d=0;d<e.length;d++){a=e[d][0],o=e[d][1],n=e[d][2];for(var i=!0,l=0;l<a.length;l++)(!1&n||r>=n)&&Object.keys(s.O).every((function(e){return s.O[e](a[l])}))?a.splice(l--,1):(i=!1,n<r&&(r=n));if(i){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[a,o,n]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,n,r=a[0],i=a[1],l=a[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(o in i)s.o(i,o)&&(s.m[o]=i[o]);if(l)var d=l(s)}for(t&&t(a);c<r.length;c++)n=r[c],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(d)},a=self["webpackChunkwebchat"]=self["webpackChunkwebchat"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(914)}));a=s.O(a)})();
//# sourceMappingURL=app.7ed38aad.js.map